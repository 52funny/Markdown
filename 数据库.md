#### tips
+ 解决`Host '192.168.1.75' is not allowed to connect to this MySQL server`
```sql
use mysql;
update user set host='%' where user='root';
FLUSH PRIVILEGES;
```
### %是通配符

```sql
show variables like 'gen%'
```
```
+----------------------------------+---------------------------+
| Variable_name                    | Value                     |
+----------------------------------+---------------------------+
| general_log                      | OFF                       |
| general_log_file                 | /var/lib/mysql/debian.log |
| generated_random_password_length | 20                        |
+----------------------------------+---------------------------+
```

### 创建数据库,并使用数据库
```sql
create database soft;
use soft;
```

### 创建表

```sql
create table stu(
    sno varchar(20),
    sname varchar(20),
    ssex char(4),
    sage smallint
);
```

`show tables;`  使用前需选中
```
+---------------+
| Tables_in_stu |
+---------------+
| stu           |
+---------------+
```

### 详细的查询表
```sql
desc stu;
show create table stu;
```

```
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| ssex  | char(4)     | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
### 修改表的属性
+ 添加字段
`alter table stu add sco int after ssex`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| ssex  | varchar(4)  | YES  |     | NULL    |       |
| sco   | int         | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
+ 修改字段 `alter table stu modify sco float;`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| ssex  | varchar(4)  | YES  |     | NULL    |       |
| sco   | float       | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

+ 重命名字段 `alter table stu change ssex sex varchar(4);`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sco   | float       | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
+ 删除字段 `alter table stu drop sco;`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

+ 对表重命名 `alter table stu rename stuinfo;`
```sql 
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
### 复制表
+ 复制表的结构和索引 `create table if not exists stu like stuinfo;`
```sql
+---------------+
| Tables_in_stu |
+---------------+
| stu           |
| stuinfo       |
+---------------+

mysql> desc stu;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

+ 复制表中的数据 `create table stunew as select sno, sname from stu;`
```sql
+---------------+
| Tables_in_stu |
+---------------+
| stu           |
| stuinfo       |
| stunew        |
+---------------+

mysql> desc stunew;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

###  删除表
  + `drop table if exists stunew;`
```sql
+---------------+
| Tables_in_stu |
+---------------+
| stu           |
| stuinfo       |
+---------------+
```
### 设置默认字段
+ 设置默认字段`alter table stu alter sex set default '男'`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | YES  |     | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | 男      |       |
| sage  | smallint    | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

+ 删除默认字段 `alter table stu alter sex drop default`
```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | NO   | PRI | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sage  | varchar(20) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
### 添加主键
```sql
create table stuinfo(
    sno varchar(20) not null,
    sname varchar(20),
    sex varchar(4),
    sage varchar(4),
    primary key(sno)
);
```
```sql 
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | NO   | PRI | NULL    |       |
| sname | varchar(20) | YES  |     | NULL    |       |
| sex   | varchar(4)  | YES  |     | NULL    |       |
| sage  | varchar(20) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

### 添加外键
+ 表级约束(在创建之后来修改)
    - `on delet` 和 `on update` 后面有很多参数可选 
```sql
[on delete {cascade| restrict |set null | no action} ]
[on update {cascade| restrict |set null | no action} ]
```

```sql
alter table sc add foreign key(sno) references stu(sno)
on update restrict
on delet restrict;
```

```sql
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | NO   | PRI | NULL    |       |
| cno   | varchar(20) | NO   | PRI | NULL    |       |
| grade | int         | NO   |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```
+ 列级约束
  - 在字段的后面加一个references
```sql
create table sc (
  sno varchar(20) not null references stu(sno),
  cno varchar(20) not null,
  grade int default 0,
  primary key(sno, cno)
);
```
```sql 
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sno   | varchar(20) | NO   | PRI | NULL    |       |
| cno   | varchar(20) | NO   | PRI | NULL    |       |
| grade | int         | YES  |     | 0       |       |
+-------+-------------+------+-----+---------+-------+
```

+ 完整性约束
```sql
create table sc(
  sno varchar(20) not null,
  cno varchar(20) not null,
  grade int not null default 0,
  primary key(sno, cno),
  constraint sc_student_fk foreign key(sno) references stu(sno)
);
```

```sql
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                                                                                                                                                                                                   |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| sc    | CREATE TABLE `sc` (
  `sno` varchar(20) NOT NULL,
  `cno` varchar(20) NOT NULL,
  `grade` int NOT NULL DEFAULT '0',
  PRIMARY KEY (`sno`,`cno`),
  CONSTRAINT `sc_stundent_fk` FOREIGN KEY (`sno`) REFERENCES `stu` (`sno`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |
+-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
```


### 删除约束
+ 删除外键 `alter table sc drop foreign key sc_stundent_fk;`
+ 删除主键 `alter table sc drop primary key;`
+ 删除非空  `alter table sc modify sno varchar(20) null`
+ 删除默认值 `alter table sc drop default`
+ 删除唯一约束 `alter table sc modify sno varchar(20)`